---
title: "Crunchtabs overview"
author: "Kamil Sedrowicz"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Crunchtabs overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The `crunchtabs` package can be used to produce three types of reports:

* Toplines 
* Cross Tabulations 
* Codebooks (Planned, not yet implenmented)

Topline and crosstabs reports can be saved as \*.tex/\*.pdf or \*.xlsx files.
Codebooks can be save as \*.tex/ or \*.pdf files.

## Quick Start

### Topline Reports

Generating a topline report is quick and easy.  

#### PDF 

```{r, eval = FALSE}
library(crunchtabs)
library(crunch)

login()

ds = loadDataset("My Dataset")

toplines_summary <- crosstabs(dataset = ds)
writeLatex(toplines_summary, filename = filename)
```

#### Excel

```{r, eval = FALSE}
library(crunchtabs)
library(crunch)

login()

ds = loadDataset("My Dataset")

toplines_summary <- crosstabs(dataset = ds)
writeExcel(toplines_summary, filename = filename)
```


### Cross Tabulation Reports

Creating a banner report 
```{r, eval = FALSE}
banner_data <- banner(ds, vars = list(`banner 1` = c('gender', 'age4')))
```
2. generate a crosstabs data summary
```{r, eval = FALSE}
crosstabs_summary <- crosstabs(dataset = ds, banner = banner_data)
```
3. call the `writeLatex` or `writeExcel` function passing it the crosstabs summary object 
```{r, eval = FALSE}
writeLatex(crosstabs_summary, filename = filename)
writeExcel(crosstabs_summary, filename = filename)
```

### Codebooks (Not yet implemented)

In order to generate a codebook:

1. generate a codebook data summary
```{r, eval = FALSE}
cb_summary <- crosstabs(ds, codebook = TRUE)
```
2. call the `writeCodebook` function passing it the codebook summary object 
```{r, eval = FALSE}
writeCodebook(cb_summary, filename = filename)
```

## Main functions

### crosstabs

The `crosstabs` function is responsible for preparing data summaries based on a Crunch dataset and input parameters.

* It generates toplies summaries by default
* If you provide it a valid banner object a crosstabs data summary will be generated
* If you set the `codebook` parameter to `TRUE` (and do not provide a banner object) a codebook data summary will be generated
* The data is not weighted by default

### writeLatex

The `writeLatex` function can be used to generate a \*.tex/\*.pdf output.

### writeExcel

The `writeExcel` function can be used to generate a \*.xlsx output.

## Examples

### Generating a toplines report
```{r, eval = FALSE}
setwd('~/reports/output')

library(crunchtabs)
library(crunch)
library(digest)

login()

dataset_name <- "Crunch Dataset"
ds <- loadDataset(dataset_name, project = 'crunchtabs')

toplines_summary <- crosstabs(ds, weight = 'weight')

writeLatex(toplines_summary, filename = dataset_name, table_of_contents = TRUE
           , field_period = "01/01/2016 - 01/01/2017", sample_desc = "Sample Description"
           , pdf = TRUE, graphicspath = "..", logo = "logo")
```

### Generating a banner report
```{r, eval = FALSE}
setwd('~/reports/output')

library(crunchtabs)
library(crunch)
library(digest)

login()

dataset_name <- "Crunch Dataset"
ds <- loadDataset(dataset_name, project = 'crunchtabs')

banner_data <- banner(ds, vars = list(Banner = c('gender', 'rase', 'age4')))

crosstabs_summary <- crosstabs(ds, weight = 'weight', banner = banner_data)

writeLatex(crosstabs_summary, filename = paste(dataset_name, "Banner")
  , title = "Report Title", subtitle = "Subtitle", table_of_contents = TRUE
  , weighted_n = TRUE, min_cell_label = "*", min_cell_size = 50
  , pdf = TRUE, graphicspath = "..", logo = "logo")
```
